<html>

<head>
  <script src="https://sandbox.kit.cash.app/v1/pay.js"></script>
</head>

<body>
  <div id="cash-app-pay"></div>
  <script type="module">
   try {
     const pay = await window.CashApp.pay({
       clientId: "CAS-CI_CASH-APP-PARTNER-ENG",
     });
     pay.addEventListener(
       "CUSTOMER_REQUEST_APPROVED",
       ({
         grants,
         referenceId,
         customerProfile
       }) => {
         // send grant to backend to authorize payment
         console.log(
           "[Pay Kit] CUSTOMER_REQUEST_APPROVED",
           grants,
           referenceId,
           customerProfile
         );
       }
     );
     pay.addEventListener(
       "CUSTOMER_REQUEST_DECLINED",
       () => {
         console.log(
           "[Pay Kit] CUSTOMER_REQUEST_DECLINED"
         );
       }
     );
     
     // await pay.render("#cash-app-pay");
     const { begin } = await pay.render('#cash-app-pay', {
        button: false,
        manage: false,
      });

     // Just trying to invoke the Cash App begin function
     // from within a timer, just to see if we can even invoke
     // the begin function outside of a click handler.
     // Had no luck with doing this oncontentload.
     setTimeout(() => {
       console.log("Invoking Cash App begin...");
       begin;
       console.log("Cash App begin invoked.");       
     }, 500);

     document.querySelector('#my-checkout-link').addEventListener('click', () => {
      begin();
    });

     const amount = {
       currency: 'USD',
       value: 1234, // $12.34
     };

     const scopeId = 'BRAND_1pk9ph4rsnj4xftcp60omnet0';
     await pay.customerRequest({
       referenceId: 'your_reference_id', // perhaps a cart or checkout identifier
       redirectURL: window.location.href, // where mobile customers should be redirected to
       actions: {
         amount:amount,
         onFile: {
           scopeId,
           accountReferenceId: "123"
         },
       },
     });
   } catch (error) {
     console.error("[Pay Kit]", error);
   }
  </script>
  <a id="my-checkout-link">My Cash App Pay</a> 
</body>

</html>
